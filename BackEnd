
import psycopg2
import getpass



#kóði  from Eyjo
host = 'localhost'
dbname = input('Database name: ') # 'gavi'

username = input('User name for {}.{}: '.format(host,dbname))  # 'postgres'
pw = getpass.getpass()  # 'postgres'

conn_string = "host='{}' dbname='{}' user='{}' password='{}'".format(host, dbname, username, pw)

print("Connecting to database {}.{} as {}".format(host, dbname, username))

conn = psycopg2.connect(conn_string)

cursor = conn.cursor()
#búum til töflurnar sem við viljum nota;
print("Connected!\n")

cursor.execute("CREATE TABLE Movies(movieid int, name varchar(250),year int, tegund varchar(250), primary key (movieid));")

conn.commit()
cursor.execute("COPY Movies (movieid,name,year,tegund) From 'C:\horritun\HV2\pmovies.csv' csv delimiter '/' ENCODING 'WIN1252';") # encoding útaf veseni með é í utf8
conn.commit()
cursor.execute("CREATE TABLE Ratings(userid int, movieid int, rating real, time_stamp varchar(250),primary key (movieid ,userid, time_stamp,rating), FOREIGN KEY(movieid) REFERENCES Movies(movieid));")
conn.commit()
print("----") 

cursor.execute("COPY Ratings(userid, movieid,rating, time_stamp ) From 'C:\horritun\HV2\pdata.csv' csv  Delimiter '/' ENCODING  'WIN1252' ;") # encoding útaf veseni með é í utf8
conn.commit()


cursor.close()
conn.close()
