import psycopg2
import getpass
import numpy as np


#kóði frá Eyjó notað til að tengjast Gagnagrunni
host = 'localhost'
dbname = 'movies' # 

username = input('User name for {}.{}: '.format(host,dbname))  # 'postgres'
pw = getpass.getpass()  # 'postgres'

conn_string = "host='{}' dbname='{}' user='{}' password='{}'".format(host, dbname, username, pw)

print("Connecting to database {}.{} as {}".format(host, dbname, username))

conn = psycopg2.connect(conn_string)

cursor = conn.cursor()
    
print("Connected!\n")
Mp = []
MovID = []
#sqlmaketable = 'CREATE TABLE Threefilms(userid int, movieid int, rating int, time_stamp varchar(250),primary key (movieid ,userid, time_stamp,rating), FOREIGN KEY(movieid) REFERENCES Movies(movieid));'
#cursor.execute(sqlmaketable)

for i in range(0,3):
	print(i)
	Mp.append(input('nafn á mynd: '))
	cursor.execute("SELECT * FROM movies WHERE name ILIKE %(id)s", {'id': Mp[i] } )
	X=cursor.fetchone()
	MovID.append(X[0])

	 
	cursor.execute("SELECT * FROM ratings WHERE movieid = %(id)s",{'id':X[0]})
	res=cursor.fetchall()
	cursor.execute('SELECT userid FROM ratings WHERE movieid = (%d)' %X[0])
	Mid = cursor.fetchall()
	
sqlthreeFilms = """
	SELECT userid,movieid,rating,time_stamp INTO Threefilms
	FROM ratings
	WHERE movieid = %s
	OR movieid = %s
	OR movieid = %s;"""

thevals = (MovID[0],MovID[1],MovID[2])

cursor.execute(sqlthreeFilms,thevals)
cursor.execute("SELECT * FROM Threefilms")
showthreeFilms = cursor.fetchall()


print(X)
print(Mid)
print(showthreeFilms)





def getshit(a,b):
    cursor.execute("SELECT R1.rating, R2.rating FROM ratings R1, ratings R2 WHERE R1.userid = R2.userid AND R1.movieid = (%s) AND R2.movieid = (%s);",(str(a),str(b)))
    #cursor.execute('SELECT movieid from movies where movieid = (%s);', str(a)]
    t = cursor.fetchall()
    ble = np.array([float(t[p][0]) - float(t[p][1]) for p in range(len(t))])
    blemean = ble.mean()
    return blemean, len(ble)

cursor.close()
conn.close()
