import psycopg2
import getpass
import pandas as pd
import numpy as np
host = 'localhost'
dbname = input('Database name: ') # 'gavi'

username = input('User name for {}.{}: '.format(host,dbname))  # 'postgres'
pw = getpass.getpass()  # 'postgres'

conn_string = "host='{}' dbname='{}' user='{}' password='{}'".format(host, dbname, username, pw)

print("Connecting to database {}.{} as {}".format(host, dbname, username))

conn = psycopg2.connect(conn_string)

cursor = conn.cursor()

print("Connected!\n")


def getshit(a,b):
    cursor.execute("SELECT R1.rating, R2.rating FROM ratings R1, ratings R2 WHERE R1.userid = R2.userid AND R1.movieid = (%s) AND R2.movieid = (%s);",(str(a),str(b)))
    #cursor.execute('SELECT movieid from movies where movieid = (%s);', str(a)]
    t = cursor.fetchall()
    ble = np.array([float(t[p][0]) - float(t[p][1]) for p in range(len(t))])
    blemean = ble.mean()
    return blemean, len(ble)


cursor.execute("SELECT count(movieid)FROM movies")
k = cursor.fetchone()
k = int(k[0])
print(k)
for i in range(1,k):
  for j in range(i+1,k+1):
    aaa = getshit(i,j)
    print(i)
    print(j)
    print(aaa)
